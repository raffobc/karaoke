<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Listado de Karaoke</title>
    <style>
        body {
            font-family: Arial, sans-serif;
 		margin: 0; /* Asegura que no haya margen alrededor de la página */
            padding-top: 100px; /* Deja espacio para la cabecera */	
	background-image: url('https://github.com/raffobc/karaoke/blob/cd8ebed9a43ee7c16038ead8686baae9994b9e63/33553.jpg?raw=true'); /* Reemplaza con la URL de tu imagen */
            background-size: 100%; /* Ajusta la imagen para que cubra todo el fondo */
            background-position: top; /* Centra la imagen de fondo */
            background-repeat: no-repeat; /* Evita que la imagen se repita */
        }
				
			#header {
				position: fixed; /* Fija la cabecera */
			            top: 0; /* La coloca en la parte superior */
			            left: 0;
			            width: 100%; /* Ocupa todo el ancho */
			            background-color: #ffffff; /* Cambia el color de fondo */
			            padding: 10px 20px; /* Añade espacio alrededor del contenido */
			            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
			            z-index: 1000; /* Asegura que esté encima de otros elementos */
			}

			#header img {
			            max-width: 200px; /* Ajusta el tamaño del logo */
			            height: auto;
			            display: block; /* Evita que el logo afecte al flujo del contenido */
			            margin: 0 auto; /* Centra el logo horizontalmente */
			}	
			#searchBoxContainer {
				position: fixed;
				top: 160px;
				left: 20px;
				right: 20px; /* Ajustar a ambos lados */
				width: calc(100% - 40px); /* Ajustar al ancho disponible */
				background-color: #40E0D0;
				padding: 10px;
				box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
				z-index: 1000;
				display: flex;
				justify-content: space-between;
				align-items: center;
			}

			#searchBoxContainer > div {
				display: flex;
				align-items: center;
				flex-grow: 1; /* Permitir que los hijos crezcan */
				margin-right: 10px; /* Espacio entre elementos */

			}

			#searchBox, #nameInput {
				width: 100%;
				padding: 10px;
				font-size: 16px;
				background-color: black;
				border: none;
				color: white;
				flex-grow: 1; /* Permitir que el elemento crezca */
				margin-right: 10px; /* Espacio entre elementos */
			}

			#submitBtn {
				padding: 10px 20px;
				font-size: 16px;
				background-color: #4CAF50;
				color: white;
				border: none;
				border-radius: 4px;
				cursor: pointer;
	            flex-shrink: 0; /* Evitar que el botón se reduzca */

			}

			#submitBtn:disabled {
				background-color: #cccccc;
				cursor: not-allowed;
			}

			#namesList {
				list-style-type: none;
				padding: 0;
				margin-top: 65px;
			}

			#namesList li {
				padding: 8px;
				background: #f9f9f9;
				margin-bottom: 5px;
				border-radius: 4px;
				display: flex;
				justify-content: space-between;
				cursor: pointer;
			}

			#namesList li.selected {
				background-color: #ADD8E6;
			}

			#namesList li.hidden {
				display: none;
			}

			#namesList li div {
				width: 30%;
			}


    </style>
</head>
<body>
    <div id="header">
        <img src="https://github.com/raffobc/karaoke/blob/cd8ebed9a43ee7c16038ead8686baae9994b9e63/logo%20karaoke.jpg?raw=true" alt="Cabecera del sitio">
    </div>

	<div id="searchBoxContainer">
		<div>
			<input type="text" id="searchBox" placeholder="Buscar artista o canción">
		</div>
		<div>
			<input type="text" id="nameInput" placeholder="Nombre">
		</div>
		<div>
			<button id="submitBtn" disabled>Enviar Selección</button>
		</div>
	</div>
	<ul id="namesList"></ul>
    <!-- Incluir Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>
    <script>
        // Configuración de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCLMQBTRT-E7Ix1PtfG9REYJX-_Zn7o0b8",
            authDomain: "karaokedelivery-45729.firebaseapp.com",
            projectId: "karaokedelivery-45729",
            storageBucket: "karaokedelivery-45729.appspot.com",
            messagingSenderId: "698577896474",
            appId: "1:698577896474:web:d9226e1a0ff11e9f10fda3"
        };

         // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        var db = firebase.firestore();

        document.addEventListener('DOMContentLoaded', function() {
            const searchBox = document.getElementById('searchBox');
            const nameInput = document.getElementById('nameInput'); // Nuevo campo de entrada de nombre
            const namesList = document.getElementById('namesList');
            const submitBtn = document.getElementById('submitBtn');
            const apiKey = 'AIzaSyC12jixhKe6UrOdqsKz5SVgOkR5tBHny4E'; // Reemplaza con tu API key
            const spreadsheetId = '1bqlfloLYVMcdoFybgZDjxt9ZZtmUTaJhUneCDJ4rQy0'; // Reemplaza con tu ID de la hoja
            const range = 'A2:B10000'; // Rango donde están los datos
            const url = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${range}?key=${apiKey}`;
            let selectedRow = null;
            let contador = 1; // Inicializar contador

            fetch(url)
                .then(response => response.json())
                .then(data => {
                    const rows = data.values;
                    rows.forEach(row => {
                        const li = document.createElement('li');
                        const nameDiv = document.createElement('div');
                        const surnameDiv = document.createElement('div');

                        nameDiv.textContent = row[0]; // Columna A
                        surnameDiv.textContent = row[1]; // Columna B

                        li.appendChild(nameDiv);
                        li.appendChild(surnameDiv);

                        li.addEventListener('click', function() {
                            // Desmarcar todos los elementos
                            const items = namesList.getElementsByTagName('li');
                            for (let i = 0; i < items.length; i++) {
                                items[i].classList.remove('selected');
                            }
                            // Marcar el elemento seleccionado
                            li.classList.add('selected');
                            selectedRow = {
                                name: row[0],
                                surname: row[1],
                                order: contador // Agregar el número de orden
                            };
                            contador++; // Incrementar el contador
                            submitBtn.disabled = false; // Habilitar el botón de enviar selección
                        });

                        namesList.appendChild(li);
                    });
                });

            searchBox.addEventListener('input', function() {
                const filter = searchBox.value.toLowerCase();
                const names = namesList.getElementsByTagName('li');
                for (let i = 0; i < names.length; i++) {
                    const name = names[i].textContent.toLowerCase();
                    if (name.includes(filter)) {
                        names[i].classList.remove('hidden');
                    } else {
                        names[i].classList.add('hidden');
                    }
                }
            });

            /*submitBtn.addEventListener('click', function() {
                if (selectedRow) {
                    db.collection('songs').add(selectedRow)
                        .then(() => {
                            alert('Selección enviada correctamente');
                            submitBtn.disabled = true;
                        })
                        .catch(error => {
                            console.error('Error al guardar la selección:', error);
                            alert('Error al enviar la selección');
                        });
                }
            });*/
			submitBtn.addEventListener('click', function() {
				const newName = nameInput.value.trim(); // Obtener el nombre del nuevo input
				if (selectedRow !== null && newName !== '') {
					const selection = {
						name: newName,
						artist: selectedRow.name, // Campo para el nombre del artista
						song: selectedRow.surname, // Campo para el nombre de la canción
						order: contador // Agregar el número de orden
					};
					//contador++; // Incrementar el contador

					db.collection('songs').add(selection)
						.then(() => {
							alert('Selección enviada correctamente');
							submitBtn.disabled = true;
						})
						.catch(error => {
							console.error('Error al guardar la selección:', error);
							alert('Error al enviar la selección');
						});
				} else {
					alert('Por favor ingrese un nombre antes de enviar la selección.');
				}
			});


			
			
        });
    </script>
</body>
</html>
